# Video Converter Daemon Configuration
# This daemon runs locally on nas01
#
# SECURITY NOTES:
# - All directories must be absolute paths
# - Codec, preset, and audio_codec are validated against allowlists at startup
# - extra_options is disabled for security (prevents arbitrary ffmpeg flag injection)
# - work_dir should NOT be under /tmp (symlink attack risk); use /var/lib/... instead
# - The daemon follows symlinks only within configured directories

# Directories to scan for videos (must be absolute paths)
directories:
  - "/media"
  - "/mnt/smallmedia"
  # Add more directories as needed

# Conversion settings
conversion:
  # Output format
  format: "m4v"

  # FFmpeg settings (validated against allowlists)
  codec: "libx264"
  crf: 23  # Quality: 0-51 (lower = better quality, larger file; 18-28 recommended)
  preset: "medium"  # ultrafast, superfast, veryfast, faster, fast, medium, slow, slower, veryslow
  audio_codec: "aac"
  audio_bitrate: "128k"

  # Additional FFmpeg options (DISABLED for security - add specific parameters above)
  extra_options: []

# Processing settings
processing:
  # Working directory for temporary files during conversion
  # Security: Use a dedicated directory outside /tmp to prevent symlink attacks
  work_dir: "/var/lib/video-converter/work"

  # State directory for tracking processed files (processed.json)
  # Separated from work_dir to isolate persistent state from temporary files
  state_dir: "/var/lib/video-converter"

  # After successful conversion
  keep_original: true  # Set to false to delete originals

  # File patterns to include (validated against known video extensions)
  include_extensions:
    - "avi"
    - "mkv"
    - "mov"
    - "mp4"
    - "flv"
    - "wmv"
    - "mpg"
    - "mpeg"

  # Skip files that match these patterns
  exclude_patterns:
    - "*.converted.*"
    - "*.converting.*"
    - "*/.backup/*"

# Daemon settings
daemon:
  # How often to scan for new files (seconds, minimum 30)
  scan_interval: 300

  # Maximum concurrent conversions (1-8)
  max_workers: 1

  # Log file location (must be absolute path)
  log_file: "/var/log/video-converter/daemon.log"
  log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
